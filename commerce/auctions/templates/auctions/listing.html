{% extends "auctions/layout.html" %}

{% block body %}

<div class="listing-details">

    {% if not listing.isactive %}
    {% if is_winner %}
    <div class="alert alert-info" role="alert">
        Auction Status : Congratulations! You've won the auction.
      </div>
    {% else %}
        <div class="alert alert-dark" role="alert">
            Auction Status : This auction is closed.
          </div>
    {% endif %}
{% endif %}

{%if user.is_authenticated %}
{%if isinwatchlist %}
    <h5>In Watchlist <span class="badge badge-secondary"><form action="{% url 'removewatchlist' listing.id %}" method="POST">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Remove</button>
    </form></span></h5>
    


        {%else %}
        <h5>Not In Watchlist:<span class="badge badge-secondary">
        <form action="{% url 'addwatchlist' listing.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">Add</button>
        </form></span></h5>
{% endif %}
{% endif %}
<h2>Listing: {{ listing.title }}</h2>

<img src="{{ listing.imageURL }}" alt="{{ listing.title }}" style="width:400px">

<p>{{listing.desc}}</p>
<h4>Category: {{ listing.category }}</h4>
<h4>Seller: {{ listing.seller }}</h4>

   
    <h4>Start Bids: ${{ listing.startbid }}</h4>
        <h4>Current Bid: ${{ listing.currentbid.bid }}</h4>
        

    {% if listing.isactive %}
        {% if user != listing.seller %}
            <!-- Update action to submit to 'bid' view -->
        <form action="{% url 'bid' listing.id %}" method="post">
    {% csrf_token %}
    <label for="bid_amount">Your Bid:</label>
    <input type="number" name="bid_amount" required>
    <button type="submit" name="bid">Place Bid</button>
</form>
        {% else %}
        <form action="{% url 'close_auction' listing.id %}" method="post">
            {% csrf_token %}
            <button type="submit" name="close_auction">Close Auction</button>
        </form>
        {% endif %}
    {% endif %}




    <!-- Comment submission form -->
    {% if user.is_authenticated %}
    <div>
        <h3>Leave a comment</h3>
        <form action="{% url 'comment' listing.id %}" method="post">
            {% csrf_token %}
            <textarea name="comment" rows="4" required></textarea>
            <button type="submit">Post Comment</button>
        </form>
    </div>
    {% endif %}

    <!-- Comments display section -->
    <div>
        <h3>Comments</h3>
        {% for comment in listing.listingcomment.all %}
        <div>
            <p><strong>{{ comment.owner.username }}</strong> - {{ comment.comment }}</p>
        </div>
        {% empty %}
        <p>No comments yet.</p>
    {% endfor %}
</div>

</div>

{% endblock %}
